싱글톤 패턴이란?
단 하나의 유일한 객체를 만들기 위한 디자인 패턴.

메모리 절약을 위해 인스턴스가 필요할 때 같은 인스턴스를 새로 만들지 않고 기존의 인스턴스를 가져와 활용하는 기법.

싱글톤 패턴이 적용된 객체가 필요한 경우는 그 객체가 리소스를 많이 차지하는 역할을 하는 무거운 클래스일대 적합함.

Ex) 데이터베이스 연결 모듈, 디스크 연결, 네트워크 통신, DBCP 커넥션풀, 스레드풀, 캐시, 로그 기록 객체 등등...

1. Eager initialization 

   장점 - static final이라 멀티 쓰레드 환경에서도 안전, 직관적 심플함

   단점 - 예외처리를 할 수 없음, 당장 객체를 사용하지 않아도 메모리에 적재해서 자원낭비 발생

2. Static block initialization 

   장점 - static block(클래스가 로딩되고 클래스 변수가 준비된 후 자동으로 실행되는 블록) 을 이용해 예외를 잡을 수 있음

   단점 - 여전히 static 공간차지.

3. Lazy initialization 

   장점 - 객체 생성에 대한 관리를 내부적으로 처리, 메서드를 호출했을 때 인스턴스 변수의 null 유무에 따라 초기화 하거나 있는걸 반환하는 기법, 미사용 고정 메모리 차지의 한계점을 극복

   단점 - 쓰레드 세이프 하지않는 치명적인 단점을 가짐

   **멀티 쓰레드 환경에서의 치명적인 문제점**

   각 스레드는 자신의 실행단위를 기억하며 코드를 위에서 아래로 읽어간다. 따라서 다음과 같은 동시성으로 인한 코드실행 문제점이 발생할 수 있게 된다.

   스레드 A, B 존재

   스레드 A if문 평가하고 인스턴스 생성 코드로 진입 (아직 초기화 진행 X)

   스레드 B가 if문 평가. 아직 스레드 A가 인스턴스화 코드를 실행 안시켰기때문에 이 if문도 참

   그러면 결과적으로 A B 인스턴스 초기화 코드를 두번 실행하는 꼴이 된다 (원자성 결여)

4. Thread safe initialization

   장점 - synchronized 키워드를 통해 메서드에 쓰레드들을 하나하나씩 접근하게 하도록 설정한다.

   단점 - 여러 모듈들이 매번 객체를 가져올 때 synchronized 메서드를 매번 호출하여 동기화 처리 작업에 overhead가 발생해 성능 하락이 발생한다. synchronized 메서드는 스레드가 해당 메서드를 실행하는 동안 다른 쓰레드를 lock을 거는 것으로 보면 됨.

5. Double - Checked Locking

   매번 synchronized 동기화를 실행하는 것이 문제라면, 최초 초기화 할때만 적용하고 이미 만들어진 인스턴스를 반환할때는 사용하지 않도록 하는 기법

   이때 인스턴스 필드에 volatile 키워드를 붙여주어야 I/O 불일치 문제를 해결할 수 있다.

   그러나 volatile 키워드를 이용하기 위해선 JVM 1.5 이상이어야 되고, JVM에 대한 심층적인 이해가 필요하여, JVM에 따라서 여전히 쓰레드 세이프 하지 않는 경우가 발생하기 때문에 사용하기를 지양하는 편

6. Bill Pugh Soulution(Lazy Holder) - 권장

   장점 - 멀티쓰레드 환경에서 안전하고 Lazy Loading도 완벽한 싱글톤 기법

   클래스 안에 내부 클래스를 두어 JVM의 클래스 로더 매커니즘과 클래스가 로드되는 시점을 이용한 방법(스레드 세이프 포함)

   static 메소드에서는 static 멤버만을 호출할 수 있기 때문에 내부 클래스를 static으로 설정 이 밖에도 내부 클래스의 치명적인 문제점인 메모리 누수 문제를 해결하기 위하여 내부 클래스를 static으로 설정

   단점 - 클라이언트가 임의로 싱글톤을 파괴할 수 있다는 단점을 지님(Reflection API, 직렬화/역직렬화를 통해)

7. Enum 이용 - 권장

   장점 - enum은 애초에 멤버를 만들때 private로 만들고 한번만 초기화 하기 때문에 스레드 세이프 함

   enum 내에서 상수 뿐만 아니라, 변수나 메서드를 선언해 사용이 가능하기 때문에, 이를 이용해 싱글톤 클래스 처럼 응용이 가능

   위의 bill pugh 와 달리 클라이언트에서 reflection을 통한 공격에도 안전

   단점 - 하지만 만일 싱글톤 클래스를 멀티톤(일반적인 클래스)로 마이그레이션 해야할 때 처음부터 코드를 다시 짜야함

   클래스 상속이 필요할 때, enum외의 클래스 상속은 불가능하다.

**정리**

6,7번 사용 싱글톤 클래스의 목적에 따라 갈리게 된다고 보면 됨.

1. LazyHolder : 성능이 중요시
2. Enum : 직렬화, 안정성 중요시

### 싱글톤 패턴의 문제점

1. 모듈간 의존성 높아짐
2. SOLID 원칙에 위배되는 사례가 많다.
3. TDD 단위 테스트에 애로사항이 있음

### 결론

싱글톤은 많은 문제점. 유연성이 떨어지는 패턴이다. 하지만 프레임워크의 도움을 받으면 패턴의 문제점들을 보완하면서 장점의 혜택을 누릴 수 있다. 스프링 프레임워크에서는 싱글톤 패턴이란게 없고 내부적으로 클래스의 제어를 IoC(제어역전) 방식의 컨테이너에게 넘겨 컨테이너가 관리하기 때문에, 이를 통해 평범한 객체도 싱글톤으로 존재가 가능하기에 싱글톤 단점이 없다.